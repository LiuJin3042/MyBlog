# VLAN

## VLAN分段

### 为何使用VLAN

* 通常, 一个交换机是一个网段, 多个交换机插在路由器上
* 访问其他网段必须通过路由器. 路由器可以隔离广播, 因此广播无法到达其他网段.
* 因此一个交换机称为一个广播域.
* 但是有的时候, 我的网段有**数十个**, 但是路由器的接口却没有这么多, 或者我想在两台交换机上**灵活分配**网段,传统的方式就显得不足.

**VLAN就是用来跨交换机构建局域网**, 优势有: 

* 安全, 隔离用户
* 降低成本, 提高性能, 减小广播域
* 提高IT员工效率, 相似网络需求的员工可以共享一个VLAN
* 简化项目管理, 无需为接线烦恼

#### VLAN类型

* 数据VLAN, 传输流量, 一般将语音流量, 管理流量, 数据流量分隔在不同VLAN上.
* 默认VLAN, 交换机端口默认属于VLAN 1.
* 本征VLAN, 链路部分收到了没有VLAN标签的数据, 就会加上本征VLAN标签.
* 管理VLAN, 访问交换机管理功能. 默认是VLAN 1.

### 多交换环境中的VLAN

#### VLAN中继

* 两个交换机个有一些VLAN
* 把两个交换机相同的VLAN连接起来的链路叫做中继, 中继网络又称为VLAN TRUNK, 像树干一样链接整个网络. 遵循IEEE 802.1Q协议
* 广播域是同一个VLAN, 即使跨越了多个交换机.

#### 标记以太网帧识别VLAN

![](C:\Users\lj\AppData\Roaming\Typora\typora-user-images\image-20191116200256396.png)

- **类型** - 2 字节值，称为标记协议 ID (TPID) 值。对于以太网，它设置为十六进制 0x8100。   

- **用户优先级** - 3 位值，支持级别或服务实施。       

- **规范格式标识符 (CFI)** - 1 位标识符，便于在以太网链路上传输令牌环帧。

-  **VLAN ID (VID)** - 12 位 VLAN 标识号，最多支持 4096 个 VLAN ID。

#### 本征VLAN

* 接入TRUNK的无VLAN设备会被分配本征VLAN
* 无VLAN设备的数据会被转发到本征VLAN中

## VLAN实施情况

### VLAN分配

#### VLAN范围

* 1-1005
  * 普通VLAN
  * 端口1, 1002-1005是自动创建的, 不可删除. 1002-1005是留给令牌和光纤分布式数据接口 (FDDI) VLAN 的.
  * 配置文件存放在flash中, 名为vlan.dat
  * VLAN中继协议管理普通VLAN
* 1006-4096
  * 扩展VLAN
  * 保存在running config里

#### 创建VLAN

创建一个VLAN

```
conf t
vlan 100
name test
end
```

为VLAN分配端口

```
conf t
inter f0/0
switchport mode access
switchport access vlan 1
end
```

